generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model category {
  category_id Int      @id @default(autoincrement())
  name        String
  laptop      laptop[]
}

model display {
  display_id      Int          @id @default(autoincrement())
  manufacturer_id Int
  name            String
  size            Int
  width           Int
  height          Int
  type            display_type
  manufacturer    manufacturer @relation(fields: [manufacturer_id], references: [manufacturer_id], onDelete: NoAction, onUpdate: NoAction)
  laptop          laptop[]

  @@index([manufacturer_id], map: "fk_display_manufacturer_id")
}

model gpu {
  gpu_id          Int          @id @default(autoincrement())
  manufacturer_id Int
  name            String
  vram            Int
  tdp             Int
  type            gpu_type
  manufacturer    manufacturer @relation(fields: [manufacturer_id], references: [manufacturer_id], onDelete: NoAction, onUpdate: NoAction)
  laptop          laptop[]

  @@index([manufacturer_id], map: "fk_gpu_manufacturer_id")
}

model laptop {
  laptop_id        Int                @id @default(autoincrement())
  manufacturer_id  Int
  storage_id       Int
  processor_id     Int
  gpu_id           Int
  display_id       Int
  category_id      Int
  name             String
  image_url        String?
  price            Int?
  favorite         favorite[]
  category         category           @relation(fields: [category_id], references: [category_id], onDelete: NoAction, onUpdate: NoAction)
  display          display            @relation(fields: [display_id], references: [display_id], onDelete: NoAction, onUpdate: NoAction)
  gpu              gpu                @relation(fields: [gpu_id], references: [gpu_id], onDelete: NoAction, onUpdate: NoAction)
  manufacturer     manufacturer       @relation(fields: [manufacturer_id], references: [manufacturer_id], onDelete: NoAction, onUpdate: NoAction)
  processor        processor          @relation(fields: [processor_id], references: [processor_id], onDelete: NoAction, onUpdate: NoAction)
  storage          storage            @relation(fields: [storage_id], references: [storage_id], onDelete: NoAction, onUpdate: NoAction)
  review           review[]
  transaction_item transaction_item[]

  @@index([category_id])
  @@index([display_id])
  @@index([gpu_id])
  @@index([manufacturer_id])
  @@index([processor_id])
  @@index([storage_id])
}

model manufacturer {
  manufacturer_id Int         @id @default(autoincrement())
  name            String
  description     String?
  display         display[]
  gpu             gpu[]
  laptop          laptop[]
  processor       processor[]
  storage         storage[]
}

model processor {
  processor_id       Int          @id @default(autoincrement())
  manufacturer_id    Int
  name               String
  core_count         Int
  tdp                Int
  hyper_thread_count Int?
  laptop             laptop[]
  manufacturer       manufacturer @relation(fields: [manufacturer_id], references: [manufacturer_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([manufacturer_id])
}

model storage {
  storage_id      Int          @id @default(autoincrement())
  manufacturer_id Int
  name            String
  type            storage_type
  laptop          laptop[]
  manufacturer    manufacturer @relation(fields: [manufacturer_id], references: [manufacturer_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([manufacturer_id])
}

model user {
  user_id     Int           @id @default(autoincrement())
  username    String
  email       String
  password    String
  status      user_status   @default(CUSTOMER)
  favorite    favorite[]
  review      review[]
  transaction transaction[]
}

model favorite {
  favorite_id Int    @id @default(autoincrement())
  user_id     Int
  laptop_id   Int
  laptop      laptop @relation(fields: [laptop_id], references: [laptop_id], onDelete: NoAction, onUpdate: NoAction)
  user        user   @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([laptop_id])
  @@index([user_id])
}

model transaction {
  transaction_id   Int                @id @default(autoincrement())
  user_id          Int
  total_amount     Int
  created_at       DateTime           @default(now())
  user             user               @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)
  transaction_item transaction_item[]

  @@index([user_id])
}

model transaction_item {
  transaction_item_id Int         @id @default(autoincrement())
  transaction_id      Int
  laptop_id           Int
  laptop_price        Int
  laptop_name         String
  laptop_category     String
  laptop              laptop      @relation(fields: [laptop_id], references: [laptop_id], onDelete: NoAction, onUpdate: NoAction)
  transaction         transaction @relation(fields: [transaction_id], references: [transaction_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([laptop_id])
  @@index([transaction_id])
}

model review {
  review_id  Int      @id @default(autoincrement())
  user_id    Int
  laptop_id  Int
  rating     Int
  comment    String
  created_at DateTime @default(now())
  laptop     laptop   @relation(fields: [laptop_id], references: [laptop_id], onDelete: NoAction, onUpdate: NoAction)
  user       user     @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction)

  @@index([laptop_id])
  @@index([user_id])
}

enum storage_type {
  M2_SSD   @map("M2 SSD")
  HDD
  SATA_SSD @map("SATA SSD")
}

enum gpu_type {
  INTEGRATED
  DEDICATED
}

enum display_type {
  OLED
  IPS
  TN
  miniLED
  QD_OLED @map("QD-OLED")
  VA
}

enum user_status {
  CUSTOMER
  ADMIN
}
